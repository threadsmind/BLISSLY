var Random=new Object({generateRandomNumber:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},generateRandomValue:function(e){return Math.floor(Math.random()*e)}}),Util=new Object({log:function(e){Blissly.doLogging&&console.log(e)}}),Constants=new Object({version:"v2019.01.10",silenceTone:!0,minimumSynths:2,maximumSynths:4,oscillatorTypesRoot:["sawtooth"],oscillatorTypes:["fatsawtooth","fatsquare","fatsine"],noiseTypes:["white","brown","pink"],scales:[["C","E","G"],["A","C#","E"],["G","B","D"],["B","D#","F#"]],scale:["C","E","G"],loopLength:10,stopColor:"#bbeea1",playColor:"#eec0a1",init:function(){Util.log("Blissly - Generate Bliss\n"+this.version),this.scale=this.scales[Random.generateRandomValue(this.scales.length)],this.loopLength=Random.generateRandomNumber(8,18)}}),Buses=new Object({vibrato:new Tone.Vibrato("1m",1).receive("vibrato").toMaster(),reverb:new Tone.Compressor({wet:0}).receive("reverb").toMaster(),crush:new Tone.BitCrusher({bits:4,wet:Random.generateRandomNumber(4,8)/100}).receive("crush").toMaster(),chorus:new Tone.Compressor({wet:0}).receive("reverb").toMaster(),init:function(){"undefined"==typeof InstallTrigger?(Buses.reverb=new Tone.JCReverb({roomSize:.2,wet:.6}).receive("reverb").toMaster(),Buses.chorus=new Tone.Chorus({depth:Random.generateRandomNumber(4,9)/10,wet:Random.generateRandomNumber(2,10)/10}).receive("chorus").toMaster()):Util.log("Firefox Compatibility Mode")}}),Master=new Object({hpFilter:new Tone.Filter(50,"highpass"),lpFilter:new Tone.Filter(19e3,"lowpass"),compressor:new Tone.Compressor({ratio:6,threshold:-18,release:.2,attack:.003,knee:20}),eq:new Tone.EQ3({low:-1,mid:-3,high:1,lowFrequency:350,highFrequency:10500}),midHighCut:new Tone.EQ3({low:0,mid:-8,high:0,lowFrequency:2750,highFrequency:5250,Q:24}),limiter:new Tone.Limiter(-6)}),Visual=new Object({display:function(e){document.getElementById("blissly-loading").style.display="none",e.style.display="block"},play:function(e){e.style.backgroundColor=Constants.playColor},stop:function(e){e.style.backgroundColor=Constants.stopColor}}),Instruments=new Object({portamento:Random.generateRandomNumber(1,4)/10,makeEnvelope:function(){return{attack:Random.generateRandomNumber(1e3,3e3)/1e3,decay:Random.generateRandomNumber(10,600)/100,sustain:Random.generateRandomNumber(6,9)/10,release:Random.generateRandomNumber(10,800)/100}},makeRoot:function(){return new Tone.Synth({oscillator:{type:Constants.oscillatorTypesRoot[Random.generateRandomValue(Constants.oscillatorTypesRoot.length)]+Random.generateRandomNumber(2,3)},envelope:this.makeEnvelope(),portamento:this.portamento})},makeNoise:function(){return new Tone.NoiseSynth({noise:Constants.noiseTypes[Random.generateRandomValue(Constants.noiseTypes.length)],envelope:this.makeEnvelope(),volume:-1*Random.generateRandomNumber(30,35)})},makeSynth:function(){return new Tone.Synth({oscillator:{type:Constants.oscillatorTypes[Random.generateRandomValue(Constants.oscillatorTypes.length)]+Random.generateRandomNumber(2,4)},envelope:this.makeEnvelope()})}}),Blissly=new Object({isPlaying:!1,doLogging:!1,isInit:!1,instruments:{root:null,noise:null,synths:[]},sends:{root:{},noise:null,synths:[]},volume:0,panel:null,button:null,slider:null,doVisuals:!0,init:function(e,t){null==e&&(e=!0),this.doVisuals=e,null==t&&(t=!1),this.doLogging=t,Constants.init(),Buses.init(),this.instruments.root=Instruments.makeRoot(),this.instruments.root.chain(Tone.Master),this.sends.root={crush:this.instruments.root.send("crush",-12),reverb:this.instruments.root.send("reverb",0),vibrato:this.instruments.root.send("vibrato",-6)},this.instruments.noise=Instruments.makeNoise(),this.instruments.noise.chain(Tone.Master);for(var n=Random.generateRandomNumber(Constants.minimumSynths,Constants.maximumSynths),s=0;s<n;)this.instruments.synths.push(Instruments.makeSynth()),this.instruments.synths[s].chain(Tone.Master),this.sends.synths[s]={reverb:this.instruments.synths[s].send("reverb",-12),chorus:this.instruments.synths[s].send("chorus",-6)},s++;Tone.Master.chain(Master.eq,Master.midHighCut,Master.hpFilter,Master.lpFilter,Master.compressor,Master.limiter);var o="";o=new RegExp("iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini","i").test(navigator.userAgent)?"touchstart":"click",this.doVisuals?(this.panel=document.getElementById("blissly-panel"),this.button=document.getElementById("blissly-button"),this.slider=document.getElementById("blissly-volume"),Visual.display(this.panel),this.slider.addEventListener("change",this.changeVolume.bind(null,this,void 0))):(this.button=document,this.slider.value=this.volume),this.button.addEventListener(o,this.togglePlay.bind(this)),this.changeVolume(this,this.slider.value),this.isInit=!0},togglePlay:function(){this.isInit&&(this.isPlaying?this.doVisuals&&this.stop(this):this.play(this))},play:function(s){this.doVisuals&&Visual.play(this.button);new Tone.Loop(function(e){for(var t in s.instruments.noise.triggerAttackRelease(Constants.loopLength,e,Random.generateRandomNumber(2,3)/10),s.instruments.root.triggerAttackRelease(Constants.scale[0]+"1",Constants.loopLength-1+"m",e+1,Random.generateRandomNumber(2,3)/10),s.instruments.synths){var n=parseInt(t)+2;s.instruments.synths[t].triggerAttackRelease(Constants.scale[Random.generateRandomValue(Constants.scale.length)]+n,Constants.loopLength-2+"m",e+1.5,Random.generateRandomNumber(5,13-2*parseInt(t))/100)}},Constants.loopLength).start(0);Tone.Transport.start("+0.2"),s.isPlaying=!0,Util.log("PLAYING")},stop:function(e){for(var t in this.doVisuals&&Visual.stop(this.button),Tone.Transport.stop(),e.instruments.root.triggerRelease(),e.instruments.noise.triggerRelease(),e.instruments.synths)e.instruments.synths[t].triggerRelease();e.isPlaying=!1,Util.log("STOPPING")},changeVolume:function(e,t){null==t?t=e.doVisuals?e.slider.value:0:0<t&&(t=0),e.volume=t,Tone.Master.volume.value=t}});